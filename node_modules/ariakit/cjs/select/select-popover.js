'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var react = require('react');
var array = require('ariakit-utils/array');
var system = require('ariakit-utils/system');
var popover_popover = require('../popover/popover.js');
var __utils = require('../__utils-87932646.js');
var select_selectList = require('./select-list.js');

/**
 * A component hook that returns props that can be passed to `Role` or any other
 * Ariakit component to render a select popover.
 * @see https://ariakit.org/components/select
 * @example
 * ```jsx
 * const state = useSelectState();
 * const props = useSelectPopover({ state });
 * <Role {...props}>
 *   <SelectItem value="Apple" />
 *   <SelectItem value="Orange" />
 * </Role>
 * ```
 */

const useSelectPopover = system.createHook(_ref => {
  var _values;

  let {
    state,
    ...props
  } = _ref;
  const values = array.toArray(state.value);
  const value = (_values = values[values.length - 1]) != null ? _values : "";
  const [item, setItem] = react.useState(null); // Sets the initial focus ref.

  react.useEffect(() => {
    let cleaning = false;
    setItem(prevItem => {
      if (cleaning) return null; // This must be state.open instead of state.mounted, otherwise
      // re-opening an animated popover before the leave animation is done
      // will not restore focus to the correct item.

      if (state.open && prevItem) return prevItem;
      const item = __utils.findEnabledItemByValue(state.items, value);
      return item || null;
    });
    return () => {
      cleaning = true;
    };
  }, [state.open, state.items, value]);
  props = select_selectList.useSelectList({
    state,
    ...props
  });
  props = popover_popover.usePopover({
    state,
    initialFocusRef: (item == null ? void 0 : item.ref) || state.baseRef,
    ...props
  });
  return props;
});
/**
 * A component that renders a select popover. The `role` prop is set to
 * `listbox` by default, but can be overriden by any other valid select popup
 * role (`listbox`, `menu`, `tree`, `grid` or `dialog`).
 * @see https://ariakit.org/components/select
 * @example
 * ```jsx
 * const select = useSelectState();
 * <Select state={select} />
 * <SelectPopover state={select}>
 *   <SelectItem value="Apple" />
 *   <SelectItem value="Orange" />
 * </SelectPopover>
 * ```
 */

const SelectPopover = system.createComponent(props => {
  const htmlProps = useSelectPopover(props);
  return system.createElement("div", htmlProps);
});

if (process.env.NODE_ENV !== "production") {
  SelectPopover.displayName = "SelectPopover";
}

exports.SelectPopover = SelectPopover;
exports.useSelectPopover = useSelectPopover;
